<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vol2bird: Python vol2bird generation script</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vol2bird
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Python <a class="el" href="structvol2bird.html">vol2bird</a> generation script </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This script is used to call <a class="el" href="structvol2bird.html">vol2bird</a> and generate vertical profiles of birds.</p>
<p>It replaces the vol2bird.groovy script.</p>
<div class="fragment"><div class="line">#!/opt/baltrad/third_party/bin/python</div><div class="line">import sys, os, glob, time, re, traceback</div><div class="line">import odim_source</div><div class="line">import _raveio, _polarvolume, _pyvol2bird</div><div class="line"></div><div class="line">VOL2BIRD_OUTPUTDIR=&quot;/tmp&quot;</div><div class="line"></div><div class="line">SOURCES=  [&quot;bejab&quot;, &quot;bewid&quot;, &quot;bezav&quot;, </div><div class="line">    &quot;dkbor&quot;, &quot;dkrom&quot;, &quot;dksin&quot;, &quot;dkste&quot;, &quot;dkvir&quot;, </div><div class="line">    &quot;eehar&quot;, &quot;eesur&quot;,</div><div class="line">    &quot;hrbil&quot;, &quot;hrosi&quot;,</div><div class="line">    &quot;fianj&quot;, &quot;fiika&quot;, &quot;fikes&quot;, &quot;fikor&quot;, &quot;fikuo&quot;,</div><div class="line">    &quot;filuo&quot;, &quot;fiuta&quot;, &quot;fivan&quot;, &quot;fivim&quot;, </div><div class="line">    &quot;frabb&quot;, &quot;frale&quot;, &quot;frbla&quot;, &quot;frbol&quot;, &quot;frbor&quot;, &quot;frbou&quot;,</div><div class="line">    &quot;frcae&quot;, &quot;frche&quot;, &quot;frcol&quot;, &quot;frgre&quot;, &quot;frlep&quot;,</div><div class="line">    &quot;frmcl&quot;, &quot;frmom&quot;, &quot;frmtc&quot;, &quot;frnan&quot;, &quot;frnim&quot;,</div><div class="line">    &quot;fropo&quot;, &quot;frpla&quot;, &quot;frtou&quot;, &quot;frtra&quot;, &quot;frtre&quot;,</div><div class="line">    &quot;nldbl&quot;, &quot;nldhl&quot;, </div><div class="line">    &quot;searl&quot;, &quot;sease&quot;, &quot;sehud&quot;, &quot;sekir&quot;, &quot;sekkr&quot;, &quot;selek&quot;,</div><div class="line">    &quot;selul&quot;, &quot;seosu&quot;, &quot;seovi&quot;, &quot;sevar&quot;, &quot;sevil&quot;, &quot;seang&quot;,</div><div class="line">    &quot;silis&quot;, &quot;sipas&quot;,</div><div class="line">    &quot;czska&quot;, &quot;czbrd&quot;,</div><div class="line">    &quot;eslid&quot;, &quot;esmad&quot;, &quot;esval&quot;, &quot;esmur&quot;, &quot;esbar&quot;, &quot;escor&quot;,</div><div class="line">    &quot;eszar&quot;, &quot;essan&quot;, &quot;essse&quot;, &quot;esbad&quot;, &quot;esmal&quot;, &quot;essev&quot;,</div><div class="line">    &quot;esalm&quot;, &quot;espma&quot;, &quot;eslpa&quot;,</div><div class="line">    &quot;deemd&quot;, &quot;deham&quot;, &quot;deboo&quot;, &quot;deros&quot;, &quot;dehan&quot;, &quot;dehnr&quot;, </div><div class="line">    &quot;debln&quot;, &quot;depro&quot;, &quot;deess&quot;, &quot;defld&quot;, &quot;deumd&quot;, &quot;deoft&quot;,</div><div class="line">    &quot;deneu&quot;, &quot;dedrs&quot;, &quot;denhb&quot;, &quot;detur&quot;, &quot;deeis&quot;, &quot;deflg&quot;,</div><div class="line">    &quot;demuc&quot;, &quot;desna&quot;, &quot;demem&quot;,</div><div class="line">    &quot;plleg&quot;, &quot;plram&quot;, &quot;plpas&quot;, &quot;plrze&quot;, &quot;plpoz&quot;, &quot;plswi&quot;,</div><div class="line">    &quot;plgda&quot;, &quot;plbrz&quot;,</div><div class="line">    &quot;nober&quot;, &quot;noosl&quot;, &quot;nohgb&quot;, &quot;norsa&quot;, &quot;norst&quot;, &quot;nobml&quot;,</div><div class="line">    &quot;noand&quot;, &quot;nohas&quot;, &quot;nosta&quot;, &quot;nohur&quot;, </div><div class="line">    &quot;ukcle&quot;, &quot;ukham&quot;, &quot;ukche&quot;, &quot;ukcas&quot;, &quot;ukpre&quot;, &quot;uking&quot;,</div><div class="line">    &quot;ukcyg&quot;, &quot;ukdud&quot;, &quot;uklew&quot;, &quot;ukcob&quot;, &quot;ukhhd&quot;, &quot;ukmun&quot;,</div><div class="line">    &quot;ukthu&quot;, &quot;ukdea&quot;, &quot;ukhmy&quot;, </div><div class="line">    &quot;chalb&quot;, &quot;chdol&quot;, &quot;chlem&quot;,</div><div class="line">    &quot;skjav&quot;, &quot;skkoj&quot;]</div><div class="line"></div><div class="line">def add_daylight(t):</div><div class="line">    l = list(t)</div><div class="line">    l[8] = -1</div><div class="line">    return tuple(l)</div><div class="line"></div><div class="line"># returns the archive time as a time tuple which can be fed to GetTimeTuple.</div><div class="line">def GetTime():</div><div class="line">  t = time.gmtime(time.time() - 15*60)</div><div class="line">  return add_daylight(t)</div><div class="line"></div><div class="line">def print_log(msg):</div><div class="line">  tt = time.gmtime(time.time())</div><div class="line">  tt = add_daylight(tt)</div><div class="line">  logtime = time.strftime(&quot;%Y-%m-%d %H:%M&quot;, tt)</div><div class="line">  print &quot;%s: %s&quot;%(logtime, msg)</div><div class="line"></div><div class="line">def getNod(src):</div><div class="line">    return odim_source.NODfromSource(src)</div><div class="line"></div><div class="line">def get_filename(src):</div><div class="line">  dd = src.date</div><div class="line">  tt = src.time</div><div class="line"></div><div class="line">  year = dd[:4]</div><div class="line">  month = dd[4:6]</div><div class="line">  day = dd[6:8]</div><div class="line">  hour = tt[:2]</div><div class="line">  minute = tt[2:4]</div><div class="line"></div><div class="line">  return &quot;%s_vp_%s%s%s%s%s00.h5&quot;%(getNod(src), year, month, day, hour, minute)</div><div class="line"></div><div class="line">def write_file_to_outdir(out_dir, outname, dst):</div><div class="line">  fname = &quot;%s/%s&quot;%(out_dir, outname)</div><div class="line">  rio = _raveio.new()</div><div class="line">  rio.object=dst</div><div class="line">  rio.save(fname)</div><div class="line">  rio.close()</div><div class="line">  print_log(&quot;Wrote %s&quot;%fname)</div><div class="line"></div><div class="line">def process_file(out_dir, in_name):</div><div class="line">  vol = _raveio.open(in_name).object</div><div class="line">  if _polarvolume.isPolarVolume(vol):</div><div class="line">    if getNod(vol) in SOURCES:</div><div class="line">      fname = get_filename(vol)</div><div class="line">      v2b = _pyvol2bird.new(vol)</div><div class="line">      # calculate a vertical profile of birds</div><div class="line">      vpr = v2b.vol2bird(vol)</div><div class="line">      write_file_to_outdir(out_dir, fname, vpr)</div><div class="line">  else:</div><div class="line">    print_log(&quot;Not a polar volume. Ignoring&quot;)</div><div class="line"></div><div class="line">def GetODCPath(tt):</div><div class="line">  import odc_filesys</div><div class="line">  return odc_filesys.GetPathFromTuple(tt)</div><div class="line"></div><div class="line">def generate(out_dir, in_dir=None):</div><div class="line">    tt = GetTime()</div><div class="line"></div><div class="line">    start = time.time()</div><div class="line"></div><div class="line">    # Which PVOLs do we already have before starting?</div><div class="line">    path = in_dir</div><div class="line">    if path == None:</div><div class="line">      path = GetODCPath(tt)</div><div class="line"></div><div class="line">    print_log(&quot;PATH=%s&quot;%path)</div><div class="line">    fstrs = glob.glob(os.path.join(path, &#39;*pvol*.h5&#39;))</div><div class="line"></div><div class="line">    for f in fstrs:</div><div class="line">      try:</div><div class="line">        process_file(out_dir, f)</div><div class="line">      except Exception, e:</div><div class="line">        traceback.print_exc()</div><div class="line"></div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">  from optparse import OptionParser</div><div class="line">  usage = &quot;usage: vol2bird_generate -o &lt;output dir&gt;&quot;</div><div class="line">  usage += &quot;&quot;</div><div class="line">  parser = OptionParser(usage=usage)</div><div class="line">  parser.add_option(&quot;-o&quot;, &quot;--outdir&quot;, dest=&quot;out_dir&quot;,</div><div class="line">                    default=VOL2BIRD_OUTPUTDIR,</div><div class="line">                    help=&quot;Name of output directory to which to write.&quot;)</div><div class="line">  parser.add_option(&quot;-i&quot;, &quot;--indir&quot;, dest=&quot;in_dir&quot;,</div><div class="line">                    default=None,</div><div class="line">                    help=&quot;Name of input directory to scan for volumes.&quot;)</div><div class="line">  (options, args) = parser.parse_args()</div><div class="line">  generate(options.out_dir, options.in_dir)</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
