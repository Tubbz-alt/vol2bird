To run \mbox{\hyperlink{structvol2bird}{vol2bird}} from Baltrad, you need to add a Route that runs \mbox{\hyperlink{structvol2bird}{vol2bird}} through R\+A\+VE. The below script will run \mbox{\hyperlink{structvol2bird}{vol2bird}} if configured as a Script Route in the Baltrad-\/\+D\+EX user interface. You\textquotesingle{}ll need an adapter, and to schedule the route, as follows.

\subsection*{Create an Adaptor}

Go to Adaptors and click Create

Name\+: R\+A\+VE Type\+: X\+M\+L\+R\+PC U\+RI\+: \href{http://eslt0045:8085/RAVE}{\tt http\+://eslt0045\+:8085/\+R\+A\+VE} Timeout\+: 5000

\subsection*{Create a Route}

Go to Routes -\/$>$ Create script

Name\+: \mbox{\hyperlink{structvol2bird}{vol2bird}} Author\+: Jurriaan and Lourens Active\+: yes Description\+: Run \mbox{\hyperlink{structvol2bird}{vol2bird}} on incoming files Recipients\+: R\+A\+VE (select) Script\+: See vol2bird.\+groovy below

\subsection*{Schedule the route}

Go to Schedule and click Create Schedule \mbox{\hyperlink{structvol2bird}{vol2bird}} every minute

\subsection*{vol2bird.\+groovy}


\begin{DoxyCode}
package eu.baltrad.vol2bird;

import java.util.HashSet;
import java.util.Set;

import org.apache.log4j.LogManager;
import org.apache.log4j.Logger;

import eu.baltrad.bdb.db.FileEntry;
import eu.baltrad.bdb.oh5.Metadata;
import eu.baltrad.bdb.oh5.TemplateMetadataNamer;
import eu.baltrad.bdb.util.Date;
import eu.baltrad.bdb.util.Time;
import eu.baltrad.beast.ManagerContext;
import eu.baltrad.beast.db.Catalog;
import eu.baltrad.beast.db.CatalogEntry;
import eu.baltrad.beast.message.IBltMessage;
import eu.baltrad.beast.rules.IScriptableRule;

import eu.baltrad.beast.message.mo.BltDataMessage;
import eu.baltrad.beast.message.mo.BltGenerateMessage;

class Vol2Bird implements IScriptableRule \{
  private static Set<String> SUPPORTED\_RADARS = new HashSet<String>([
    "bejab", "bewid", "bezav", "dkbor", "dkrom",
    "dksin", "dkste", "dkvir", "eehar", "eesur",
    "fianj", "fiika", "fikes", "fikor", "fikuo",
    "filuo", "fiuta", "fivan", "fivim", "frabb",
    "frale", "frbla", "frbol", "frbor", "frbou",
    "frcae", "frche", "frcol", "frgre", "frlep",
    "frmcl", "frmom", "frmtc", "frnan", "frnim",
    "fropo", "frpla", "frtou", "frtra", "frtre",
    "hrbil", "hrosi", "nldbl", "nldhl", "searl",
    "sease", "sehud", "sekir", "sekkr", "selek",
    "selul", "seosu", "seovi", "sevar", "sevil",
    "silis", "sipas"
  ]);

  private Logger logger = LogManager.getLogger(Vol2Bird.class);

  public Vol2Bird() \{
  \}

  private boolean isSupported(String radar) \{
    return SUPPORTED\_RADARS.contains(radar);
  \}

  @Override
  public IBltMessage handle(IBltMessage bltmsg) \{
    BltGenerateMessage result = null;

    if (bltmsg != null && bltmsg instanceof BltDataMessage) \{
      FileEntry fe = ((BltDataMessage)bltmsg).getFileEntry();

      String object = fe.getMetadata().getWhatObject();
      if (object != null && object.equals("PVOL")) \{
        Metadata metadata = fe.getMetadata();
        String radar = metadata.getAttribute("/\_bdb/source\_name");

        if (isSupported(radar)) \{
          Catalog cat = ManagerContext.getCatalog();

          result = new BltGenerateMessage();
          result.setAlgorithm("eu.baltrad.beast.vol2bird");
          result.setFiles([fe.getUuid().toString()] as String[])
          result.setArguments(new String[0]);
        \}
        else \{
          logger.error(sprintf("Radar %s not supported by vol2bird", radar));
          logger.info("Supported radars:");
          for (String s : SUPPORTED\_RADARS) \{
            logger.info(s);
          \}
        \}
      \}
    \}
    return result;
  \}
\}
\end{DoxyCode}
 